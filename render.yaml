services:
  - type: web
    name: b0-backend
    env: python
    region: oregon
    plan: starter # TODO: change to pro
    # Build Command: Render runs this command to build your app before each deploy
    buildCommand: ./build.sh
    # Pre-Deploy Command (Optional): Render runs this command before the start command.
    # Useful for database migrations and static asset uploads.
    # preDeployCommand: 
    # Start Command: Render runs this command to start your app with each deploy
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: LOG_LEVEL
        value: INFO
      - key: GITHUB_TOKEN
        sync: false
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
      - key: AUTH_DOMAIN
        sync: false
      - key: AUTH_AUDIENCE
        sync: false
    healthCheckPath: /health
    autoDeploy: true
    scaling:
      minInstances: 1
      maxInstances: 10
      targetCPUPercent: 70
      targetMemoryPercent: 80

# Multi-region configuration
# To enable multi-region, uncomment and configure additional services below:
#   - type: web
#     name: b0-backend-eu
#     env: python
#     region: frankfurt
#     plan: starter
#     # Build Command: Render runs this command to build your app before each deploy
#     buildCommand: ./build.sh
#     # Pre-Deploy Command (Optional): Render runs this command before the start command.
#     # Useful for database migrations and static asset uploads.
#     # preDeployCommand: 
#     # Start Command: Render runs this command to start your app with each deploy
#     startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
#     envVars:
#       - key: ENVIRONMENT
#         value: production
#       - key: LOG_LEVEL
#         value: INFO
#       - key: SUPABASE_URL
#         sync: false
#       - key: SUPABASE_KEY
#         sync: false
#       - key: AUTH_DOMAIN
#         sync: false
#       - key: AUTH_AUDIENCE
#         sync: false
#       - key: GITHUB_TOKEN
#         sync: false
#     healthCheckPath: /health
#     autoDeploy: true
#     scaling:
#       minInstances: 1
#       maxInstances: 10
#       targetCPUPercent: 70
#       targetMemoryPercent: 80

